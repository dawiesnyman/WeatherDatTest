<!DOCTYPE html>
<html>
	<head>
	<style>
		thead {color:green;}
		tbody {color:blue;}
		tfoot {color:red;}
		table,th,td	{border:1px solid black;}
	</style>

	<script src="dat.js"></script>
	<script src="dataService.js"></script>
	<script src="fileParser.js"></script>
</head>
<body>
<p></p>
<table border="1" style="width:300px">
		<thead>
		<tr>
			<th>Key</th>
			<th>Day</th>
			<th>Value</th>
		</tr>
		</thead>
		<tbody>
		<tr>
			<td>Min MnT</td>
			<td><label id="lblMnTDay"></label></td>
			<td><label id="lblMnT"></label></td>
		</tr>
		<tr>
			<td>Max MxT</td>
			<td><label id="lblMxTDay"></label></td>
			<td><label id="lblMxT"></label></td>
		</tr>
		</tfoot>
		</table>
<H5>Please select a file or drag and drop it onto the folder icon.</H5>

<div id="drop_zone">
	<input type="file" id="fileinput" />
	<br>
	<br>
	<img src="./img/folder.png" />
</div>
</body>
<script type="text/javascript">

	triggerFileRead = async (event) => {
		event.stopPropagation();
		event.preventDefault();

		//is it from the button or drag drop?		
		if(event.type == "change")		{
			readFile(event.target.files[0]);
		}else{
			readFile(event.dataTransfer.files[0]);
		}
	}

	readFile = async (file) => {		
		var dataService = new DataService();
		try {
			//load data
			let fileContents = await dataService.readData(file)  
			
			//parse string data
			let parser = new Parser(fileContents);
			let days = parser.parse();
			
			//for (var i = 0; i < days.length; i++) {	console.log(days[i]); }

			//get min Mnt
			let minMnT = days.reduce(function (smallest, day) {
				return (day.MnT || 0) > (smallest.MnT) ? smallest : day;
				}, {});
		
			//get max MxT
			let maxMxT = days.reduce(function (smallest, day) {
				return (smallest.MxT || 0) > (day.MxT) ? smallest : day;
			}, {});

			console.log(minMnT.dy);			
			console.log(maxMxT);

			//lblMnT
			document.getElementById('lblMnTDay').innerHTML = minMnT.Dy;
			document.getElementById('lblMnT').innerHTML = minMnT.MnT;
			document.getElementById('lblMxTDay').innerHTML = maxMxT.Dy;
			document.getElementById('lblMxT').innerHTML = maxMxT.MxT;
		} catch (e) {
			console.warn(e.message)
		}

		//console.log(fileContents);
	}

function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

// Setup the dnd listeners.
var dropZone = document.getElementById('drop_zone');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', triggerFileRead, false);

//hook up fileInput
document.getElementById('fileinput').addEventListener('change', triggerFileRead, false);
</script>
</html>