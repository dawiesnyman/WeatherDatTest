<!DOCTYPE html>
<html>
<p></p>
<H5>Please select a file or drag and drop it onto the folder icon...</H5>
<div>
	<p>

	</p>
</div>
<div id="drop_zone">
	<img src="./img/folder.png" />
	<br>
	<input type="file" id="fileinput" />
</div>
<script src="dat.js"></script>
<script src="dataService.js"></script>
<script src="fileParser.js"></script>
<script type="text/javascript">

	triggerFileRead = async (event) => {
		event.stopPropagation();
		event.preventDefault();
				
		if(event.type == "change")		{
			readFile(event.target.files[0]);
		}else{
			readFile(event.dataTransfer.files[0]);
		}
	}

	readFile = async (file) => {		
		var dataService = new DataService();
		try {
			//load data
			let fileContents = await dataService.readData(file)  
			
			//parse string data
			let parser = new Parser(fileContents);
			let days = parser.parse();
	
			//for (var i = 0; i < days.length; i++) {	console.log(days[i]); }

			//get min Mnt
			let minMnT = days.reduce(function (smallest, day) {
				return (day.MnT || 0) > (smallest.MnT) ? smallest : day;
				}, {});
		
			//get max MxT
			let maxMxT = days.reduce(function (smallest, day) {
				return (smallest.MxT || 0) > (day.MxT) ? smallest : day;
			}, {});

			console.log(minMnT);			
			console.log(maxMxT);
		} catch (e) {
			console.warn(e.message)
		}

		//console.log(fileContents);
	}

function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

// Setup the dnd listeners.
var dropZone = document.getElementById('drop_zone');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', triggerFileRead, false);

//hook up fileInput
document.getElementById('fileinput').addEventListener('change', triggerFileRead, false);
</script>
</html>